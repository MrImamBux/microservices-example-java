FROM openjdk:8-jre-alpine

ARG PROFILE
ARG SERVER_PORT
ARG DISCOVERY_SERVICE_URI
ARG CONFIGURATION_SERVER_URI
ARG SECURITY_SERVICE_URI
ARG DATABASE_SERVER_URI
ARG CACHE_SERVER_URI
ARG LOGGING_GUI_URI
ARG KAFKA_URI
ARG ZOOKEEPER_URI
ARG DISCOVERY_SERVICE_PORT
ARG CONFIGURATION_SERVER_PORT
ARG SECURITY_SERVICE_PORT
ARG DATABASE_SERVER_PORT
ARG CACHE_SERVER_PORT
ARG LOGGING_GUI_PORT
ARG KAFKA_PORT
ARG ZOOKEEPER_PORT
ARG ENCRYPT_KEY

# sets environment variable
ENV PROFILE ${PROFILE}
ENV SERVER_PORT ${SERVER_PORT}
ENV DISCOVERY_SERVICE_URI ${DISCOVERY_SERVICE_URI}
ENV CONFIGURATION_SERVER_URI ${CONFIGURATION_SERVER_URI}
ENV SECURITY_SERVICE_URI ${SECURITY_SERVICE_URI}
ENV DATABASE_SERVER_URI ${DATABASE_SERVER_URI}
ENV CACHE_SERVER_URI ${CACHE_SERVER_URI}
ENV LOGGING_GUI_URI ${LOGGING_GUI_URI}
ENV KAFKA_URI ${KAFKA_URI}
ENV ZOOKEEPER_URI ${ZOOKEEPER_URI}
ENV DISCOVERY_SERVICE_PORT ${DISCOVERY_SERVICE_PORT}
ENV CONFIGURATION_SERVER_PORT ${CONFIGURATION_SERVER_PORT}
ENV SECURITY_SERVICE_PORT ${SECURITY_SERVICE_PORT}
ENV DATABASE_SERVER_PORT ${DATABASE_SERVER_PORT}
ENV CACHE_SERVER_PORT ${CACHE_SERVER_PORT}
ENV LOGGING_GUI_PORT ${LOGGING_GUI_PORT}
ENV KAFKA_PORT ${KAFKA_PORT}
ENV ZOOKEEPER_PORT ${ZOOKEEPER_PORT}
ENV ENCRYPT_KEY ${ENCRYPT_KEY}

RUN mkdir /usr/local/licensing-service

# filter resources names with maven
# copy resources from local to docker
ADD @ARTIFACT@ /usr/local/licensing-service
ADD ./run.sh run.sh

# provide execute permissions and execute the scripts
RUN chmod +x run.sh
CMD ./run.sh